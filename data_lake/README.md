# Создание Date Lake
В ходе проекта была поставлена цель из сырых данных сформироватьслой даных и слой витрин для социальной сети.

## Задачи проектирования Date Lake
При проектировании Date Lake необходимо было:
1. Провести миграцию сырых данных из общего хранилища в слой данных
2. Создать витрину в разрезе пользователей, содержащую информацию о ближайшем городе из которого было отправлено сообщение, о родном городе, о количестве путешествий и собрать список посещённых городов.
3. Для каждого города создать витрину содержащую статистическую информацию за последнюю неделю и месяц (в том числе информацию о количестве сообщени, реакций, подписок и регистраций)
4. Построить витрину для рекомендации друзей. Рекомендации должны строиться по следующим условиям:
	
	- Пользователи не должны были писать до этого друг другу.
	- Пользователи должны состоять хотя бы в одном общем сообществе.
	- пользователи должны быть на ростоянии менее километра друго от друга. 	
	
5. Обеспечить автоматизацию обновления созданных ветрин.

## Структура Date Lake
Структура Date Lake имеет следующий вид

* /user/yaroslavkn/data - слой данных
    * /user/yaroslavkn/data/geo/events - папка с событиями партицированная по датам и событиями (с учтёом координат)
    * /user/yaroslavkn/data/catalog - папка со справочниками (в том числе справочник с координатами городов)
    * /user/yaroslavkn/data/actual_city - папка с таблицами актуальных городов по пользователям в разрезе дат
    * /user/yaroslavkn/data/tmp - временная папка для отработки и тестирования скриптов
    * /user/yaroslavkn/data/user_registrated - папка с информацией о зарегистрированных пользователях по датам
* /user/yaroslavkn/cdm - слой витрин
    * /user/yaroslavkn/cdm/user_travel - витрина с информацией о путешествиях пользователя согласно геолокации
    * /user/yaroslavkn/cdm/city_info - витрина с информацией о статистике по городам
    * /user/yaroslavkn/cdm/rec_user - витрина с информацией о рекомендациях пользователям

## Автоматизация обновления
Учитывая, что требуется обеспечить систематическое обновление, то для этой задачи хорошо подойдёт Airflow, при этом необходимо учесть, что ряд обновлений являются ежедненвыми, а информацию о городе должна собираться раз в неделю. Поэтому необходимо будет создать минимум 2 дага.

## Структура проекта
В корне проекта расположена папка dag в ней находятся два файла для запуска ежедневного и еженедельного дага. Также в этой папке расположена папка scripts со скриптами обеспечивающих выполнение дагов. Функциональное назначение скриптов:

- partition.py - переносит данные по событиям из в слой data;
- actualize_city.py - создаёт данные по пользователю по актуальному городу и таймзоне;
- get_user_travel - собираетданные по путешествиям пользователя и формирует витрину (пункт 2);
- get_registratration.py - по каждой дате формирует датасет с новыми пользователями;
- get_city_info.py - еженедельно формирует витрину с информацией по городам (пункт 3);
- rec_user.py - формирует витрину с рекомендациями новых контактов (пункт 4);