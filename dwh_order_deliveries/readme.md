
# Разработка дагов Airflow для создания и наполнения DWH на нескольких источниках данных (PostgreSQL, Mongo-DB, API)

Разработаны даги Airflow для создания и наполнения DWH на нескольких источниках данных. Специфика задачи заключалась в том, что сырые данные хранятся на сервисах с различными источниками данных:
* Данные по бонусам в PostgreSQL
* Данные по заказами в Mongo-DB
* Данные по доставкам доступны по API

Данные из указанных источников необходимо было сохранить в единое хранилище и создать две **витрины** данных:
* Витрину по ресторанам и датам, которая позволяла бы определять на какую сумму были совершены заказы за определённую дату, их количество, количество использованных и полученных бонусов. Данные для этой задачи хранились в системах PosgreSQL и Mongo-DB. В качестве схемы для dds слоя была выбрана "Снежинка".
* Витрину для доставщиков, которая позволяла бы определять заработанную сумму за прошедший месяц. Даг для данной витрины создали полностью изолированным. Вся информация, необходимая для его функционирования была получена по API. Для данной задачи dds слой был построен по схеме "Звезда".

При реализации проекта были созданы три слоя:
* stg - слой для хранения сырых данных "как есть" в источнике. Данный слой периодически дополняется новыми данными из источника, поэтому в нём реализована инкрементная загрузка данных.
* dds - слой для обработанных данных. Данные в этом слое хранятся в соответствии с выбранной ранее схемой в таблицах измерений и фактов.
* cdm - слой для хранения витрины данных.
	
## Структура репозитория
Репозиторий имеет следующую структуру
├── [src](src)
│    ├── [dags](src/dags)           		<- Папка с дагами
│    │    ├── [dag_orders_restaurants.py](src/dags/dag_orders_restaurants.py) <- **Файл дага** для построения витрины по ресторанам
│    │    ├── [dag_deliveries.py](src/dags/dag_deliveries.py) <- **Файл дага** для построения витрины по доставщикам
│    │    ├── [lib](src/dags/lib)        		<- Папка с библиотеками для функционирования бизнес логики (БЛ)
│    │    │  
│    │    ├── [orders_restaurants](src/dags/orders_restaurants)          <- Папка с БЛ для функционирования дага для построения витрины по ресторанам
│    │    │    ├── [ddl](src/dags/orders_restaurants/ddl)     		<- Папка с БЛ для инициализации схем и таблиц для данного дага
│    │    │    │    ├── [scripts_ddl](src/dags/orders_restaurants/ddl/scripts_ddl)  	<- Папка со скриптами создания схем и таблиц
│    │    │    ├── [stg](src/dags/orders_restaurants/stg) 			<- Папка с БЛ для получения данных из источников для stg слоя
│    │    │    ├── [dds](src/dags/orders_restaurants/dds) 			<- Папка с БЛ для заполнения dds слоя
│    │    │    ├── [cdm](src/dags/orders_restaurants/cdm) 				<- Папка с БЛ для заполнения создания витрины
│    │    │  
│    │    ├── [deliveries](src/dags/deliveries)        	<- Папка с БЛ для функционирования дага для построения витрины доставки
│    │    │    ├── [ddl](src/dags/deliveries/ddl)     		<- Папка с БЛ для инициализации схем и таблиц для данного дага
│    │    │    │    ├── [scripts_ddl](src/dags/deliveries/ddl/scripts_ddl) 	<- Папка со скриптами создания схем и таблиц
│    │    │    ├── [stg](src/dags/deliveries/stg)  			<- Папка с БЛ для получения данных из источников для stg слоя
│    │    │    ├── [dds](src/dags/deliveries/dds)  			<- Папка с БЛ для заполнения dds слоя
│    │    │    ├── [cdm](src/dags/deliveries/cdm)  				<- Папка с БЛ для заполнения создания витрины